'use strict'

var Task = require('data.task')
var xhr = require('xhr')
var { curry, prop, compose, map } = require('ramda')

var get = (path) => request('get', path, {})

var post = curry((body, path) => request('post', path, { json: body }))

var del = (path) => request('del', path, {})

var get_body = compose(map(compose(JSON.parse, prop('body'))), get)
var post_body = compose(map(prop('body')), post)

function request (method, path, options) {
  return new Task(function (reject, resolve) {
    xhr[method](path, options, function (err, res, body) {
      err ? reject(err) : resolve(res)
    })
  })
}

module.exports = { get, post, del, request, get_body, post_body }

'use strict'

const { clone } = require('ramda')
const { plus, minus } = require('./money_arith')

module.exports = function (payments) {
  return payments.reduce(make_payments_with_balance, [0]) }

function make_payments_with_balance (rows, payment) {
  var new_balance = update_balance(rows[0], payment)
  var decorated_payment = clone(payment)
  decorated_payment['balance due'] = new_balance
  return [new_balance].concat(rows.slice(1)).concat([decorated_payment]) }

const update_balance = (balance, { category, amount }) =>
  (category === 'payment' ? minus : plus)(balance)(amount)

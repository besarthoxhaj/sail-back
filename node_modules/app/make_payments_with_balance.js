module.exports = function (payments) {
  return payments.reduce(make_payments_with_balance, [0]) }

function make_payments_with_balance (rows, payment) {
  var new_balance = update_balance(rows[0], payment)
  var decorated_payment = require('clone')(payment)
  decorated_payment['balance due'] = new_balance
  return [new_balance].concat(rows.slice(1)).concat([decorated_payment]) }

function update_balance (balance, payment) {
  return balance + (payment.category === 'payment' ?
      - +payment.amount : +payment.amount)}


'use strict'

var Maybe = require('data.maybe')
var maybe = Maybe.fromNullable

module.exports = function (date_string) {
  if (!date_string || date_string.match('T')) { return date_string }
  var parts = date_string.split(/[\/-]/)
  return safe_date(year_pad(parts[2]) + ', ' + parts[1] + ', ' + parts[0], 'GMT')
      .map(to_ISO_string).value }

function year_pad (year_string) {
  var len = year_string && year_string.length
  return len > 3 ? year_string :
      len === 2 ? '20' + year_string :
      len === 1 ? '200' + year_string :
      new Date().getFullYear().toString() }

function to_ISO_string (date) {
  return date.toISOString() }

function safe_date (str) {
  var d = new Date(str)
  return maybe(isNaN(d.getTime()) ? null : d) }
'use strict'

var S = require('sanctuary')
var R = require('ramda')

module.exports = function (d) {
  var date = format_date(d)
  if (date[1] == null) return date[0]
  return date[1]
}

module.exports.date_only = S.pipe(
  [ check_date
  , date_only
  , S.either(S.I, S.I)
   ]
)

function date_only (d) {
  return d.map(date => date.toISOString().split('T')[0])
}

function format_date (d) {
  var date = check_date(d) // allows arg to be date string
  date.map(d => d.setHours(12)) // hack because of weirdness with times, sails and waterline
  var dateString = date_only(date)
  return dateString.map(s => s.split('-').reverse().join('/'))
}

module.exports.format_due_date = function format_due (d) {
  return S.either(S.I, date => date.slice(0, ('/YYYY'.length)), format_date(d))
}

function check_date (date) {
  return R.ifElse(Boolean, S.Right, S.Left)(date).chain(S.compose(S.maybeToEither(''), S.parseDate))
}

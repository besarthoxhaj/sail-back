'use strict'

module.exports = function (d) {
  var date = format_date(d)
  if (date[1] == null) return date[0]
  return date[1]
}

module.exports.format_date_SQL = function (d) {
  var date = format_date(d)
  return date[2]
}

function format_date (d) {
  var date = new Date(d) // allows arg to be date string
  if (!d || is_bad_date(date)) return [ d, null ]
  date.setHours(12) // hack because of weirdness with times, sails and waterline
  var dateString = date.toISOString().split('T')[0]
  return [ null, dateString.split('-').reverse().join('/'), dateString ]
}

module.exports.format_due_date = function format_due (d) {
  var date = format_date(d)
  if (date[1] == null) return date[0]
  return date[1].slice(0, -('/YYYY'.length))
}

function is_bad_date (date) {
  return isNaN(date.getTime())
}

'use strict'

var S = require('sanctuary')
var R = require('ramda')

module.exports = function (d) {
  var date = format_date(d)
  return S.either(S.I, S.I)(date)
}

module.exports.date_only = S.pipe(
  [ check_date
  , date_only
  , S.either(S.I, S.I)
   ]
)

function date_only (d) {
  return d.map(date => date.split('T')[0])
}

function format_date (d) {
  var date = check_date(d) // allows arg to be date string
  date.map(d => date_to_string((new Date(d)).setHours(12))) // hack because of weirdness with times, sails and waterline
  date = date_only(date)
  return date.map(s => s.split('-').reverse().join('/'))
}

module.exports.format_due_date = function format_due (d) {
  return S.either(S.I, date => date.slice(0, ('/YYYY'.length)), format_date(d))
}

function date_to_string (d) {
  return (new Date(d)).toISOString()
}

function check_date (date) {
  return R.ifElse(Boolean, S.Right, S.Left)(date).chain(S.encaseEither(R.identity, date_to_string))
}
